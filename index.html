<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZenTrack ‚Äì Stress Detection & Therapy</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/3774/3774299.png" />
  <style>
    :root {
      --primary: #6366f1;
      --secondary: #06b6d4;
      --accent: #fbbf24;
      --bg: #f8fafc;
      --card-bg: #fff;
      --text: #1e293b;
      --muted: #64748b;
      --border: #e2e8f0;
      --radius: 18px;
      --shadow: 0 4px 24px rgba(99,102,241,0.08);
      --feature-gradient: linear-gradient(120deg, #e0e7ff 60%, #cffafe 100%);
      --feature-gradient-hover: linear-gradient(120deg, #dbeafe 60%, #a7f3d0 100%);
    }
    html.dark, body.dark {
      --primary: #818cf8;
      --secondary: #22d3ee;
      --accent: #fbbf24;
      --bg: #18181b;
      --card-bg: #23232a;
      --text: #e5e7eb;
      --muted: #a1a1aa;
      --border: #27272a;
      --feature-gradient: linear-gradient(120deg, #23232a 60%, #18181b 100%);
      --feature-gradient-hover: linear-gradient(120deg, #18181b 60%, #23232a 100%);
    }
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      scroll-behavior: smooth;
      transition: background .3s, color .3s;
    }
    body {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: #fff;
      padding: 32px 0 16px 0;
      text-align: center;
      box-shadow: var(--shadow);
      border-bottom-left-radius: var(--radius);
      border-bottom-right-radius: var(--radius);
      position: relative;
      z-index: 2;
    }
    header h1 {
      font-size: 2.7rem;
      font-weight: 800;
      margin: 0;
      letter-spacing: 1px;
      text-shadow: 0 2px 8px rgba(0,0,0,0.08);
      animation: fadeInDown 1s;
    }
    .dark-toggle {
      position: absolute;
      top: 18px;
      right: 32px;
      background: rgba(255,255,255,0.12);
      border: none;
      border-radius: 50px;
      padding: 8px 18px;
      color: #fff;
      font-size: 1.1rem;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: background .2s, color .2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .dark-toggle:hover {
      background: var(--accent);
      color: #23232a;
    }
    @keyframes fadeInDown {
      from { opacity: 0; transform: translateY(-40px);}
      to { opacity: 1; transform: translateY(0);}
    }
    nav {
      display: flex;
      justify-content: center;
      gap: 28px;
      background: var(--card-bg);
      box-shadow: var(--shadow);
      padding: 12px 0;
      position: sticky;
      top: 0;
      z-index: 10;
      border-bottom: 1px solid var(--border);
      animation: fadeInDown 1.2s;
      transition: background .3s, color .3s;
    }
    nav a {
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
      padding: 8px 18px;
      border-radius: 12px;
      transition: background .2s, color .2s;
      font-size: 1.08rem;
    }
    nav a:hover, nav a.active {
      background: var(--primary);
      color: #fff;
    }
    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 32px;
      padding: 32px 0;
      max-width: 900px;
      margin: 0 auto;
      width: 100%;
      animation: fadeInUp 1.2s;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(40px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 32px 28px;
      margin-bottom: 24px;
      border: 1px solid var(--border);
      animation: fadeInUp .8s;
      transition: box-shadow .2s, background .3s, color .3s;
    }
    .card:hover {
      box-shadow: 0 8px 32px rgba(99,102,241,0.12);
    }
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }
    .feature-card {
      background: var(--feature-gradient);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 24px 18px;
      text-align: left;
      cursor: pointer;
      transition: box-shadow .2s, transform .2s, background .3s;
      border: 1px solid var(--border);
      position: relative;
      overflow: hidden;
    }
    .feature-card:hover {
      box-shadow: 0 8px 32px rgba(6,182,212,0.12);
      transform: translateY(-4px) scale(1.03);
      background: var(--feature-gradient-hover);
    }
    .feature-card h3 {
      margin: 0 0 0.5em 0;
      font-size: 1.25rem;
      color: var(--primary);
      font-weight: 700;
    }
    .feature-card p {
      color: var(--muted);
      margin-bottom: 1em;
      font-size: 1.05rem;
    }
    .feature-card .btn {
      margin-top: 8px;
    }
    .dashboard-images {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 18px;
      margin-bottom: 2em;
    }
    .dashboard-images img {
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      width: 100%;
      height: 120px;
      object-fit: cover;
      transition: transform .3s, box-shadow .3s;
      animation: fadeInUp .8s;
    }
    .dashboard-info {
      margin-bottom: 2em;
      background: rgba(99,102,241,0.07);
      border-radius: var(--radius);
      padding: 18px 20px;
      color: var(--text);
      font-size: 1.08rem;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: background .3s, color .3s;
    }
    .dashboard-info strong {
      color: var(--primary);
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all .3s cubic-bezier(.4,0,.2,1);
      box-shadow: 0 2px 8px rgba(34,211,238,0.08);
      font-size: 1rem;
      margin-top: 8px;
    }
    .btn-primary {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: white;
    }
    .btn-primary:hover {
      opacity: 0.9;
      transform: scale(1.07);
      box-shadow: 0 4px 16px rgba(124,58,237,0.15);
    }
    .btn-secondary {
      background: #fff;
      color: var(--primary);
      border: 1px solid var(--primary);
    }
    .btn-secondary:hover {
      background: var(--primary);
      color: #fff;
      transform: scale(1.07);
      box-shadow: 0 4px 16px rgba(34,211,238,0.12);
    }
    input, select, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #f1f5f9;
      color: var(--text);
      margin-bottom: 12px;
      font-size: 1rem;
      transition: border-color .2s, background .3s, color .3s;
    }
    html.dark input, html.dark select, html.dark textarea,
    body.dark input, body.dark select, body.dark textarea {
      background: #23232a;
      color: #e5e7eb;
      border: 1px solid var(--border);
    }
    input:focus, select:focus, textarea:focus {
      border-color: var(--primary);
      outline: none;
    }
    #chatBox {
      background: #f1f5f9;
      border-radius: 12px;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      margin-bottom: 10px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: box-shadow .3s, background .3s, color .3s;
      font-size: 1rem;
    }
    html.dark #chatBox, body.dark #chatBox {
      background: #23232a;
      color: #e5e7eb;
    }
    .message {
      margin: 5px 0;
      padding: 8px 12px;
      border-radius: 12px;
      max-width: 75%;
      animation: fadeInUp .5s;
      word-break: break-word;
      font-size: 1rem;
    }
    .user {
      background: var(--secondary);
      color: #fff;
      margin-left: auto;
      text-align: right;
    }
    .bot {
      background: var(--primary);
      color: #fff;
      margin-right: auto;
      text-align: left;
    }
    canvas {
      width: 100% !important;
      height: 300px !important;
      border-radius: 12px;
      box-shadow: var(--shadow);
      background: #fff;
      margin-top: 12px;
    }
    html.dark canvas, body.dark canvas {
      background: #23232a !important;
    }
    footer {
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: #fff;
      text-align: center;
      padding: 32px 10px 16px 10px;
      margin-top: 40px;
      border-top-left-radius: var(--radius);
      border-top-right-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: background .3s, color .3s;
    }
    .socials {
      display: flex;
      justify-content: center;
      gap: 18px;
      margin-top: 10px;
    }
    .socials a {
      color: #fff;
      font-size: 22px;
      transition: color .3s, transform .3s;
      text-decoration: none;
    }
    .socials a:hover {
      color: var(--accent);
      transform: scale(1.2);
    }
    #contactForm {
      margin: 24px auto 0 auto;
      max-width: 400px;
      background: rgba(255,255,255,0.07);
      padding: 18px 16px;
      border-radius: 14px;
      box-shadow: var(--shadow);
      transition: background .3s, color .3s;
    }
    html.dark #contactForm, body.dark #contactForm {
      background: rgba(30,41,59,0.7);
      color: #e5e7eb;
    }
    #contactForm input, #contactForm textarea {
      background: #fff;
      color: var(--text);
      border: 1px solid var(--border);
    }
    html.dark #contactForm input, html.dark #contactForm textarea,
    body.dark #contactForm input, body.dark #contactForm textarea {
      background: #23232a;
      color: #e5e7eb;
      border: 1px solid var(--border);
    }
    #contactForm input:focus, #contactForm textarea:focus {
      border-color: var(--secondary);
    }
    #contactForm button {
      width: 100%;
      margin-top: 8px;
    }
    .option-select-row {
      display: flex;
      gap: 12px;
      margin: 18px 0 8px 0;
    }
    .option-select-btn {
      flex: 1;
      padding: 16px 0;
      border-radius: 10px;
      background: #f1f5f9;
      color: var(--primary);
      font-size: 1.1rem;
      font-weight: 600;
      border: 2px solid var(--border);
      cursor: pointer;
      transition: background .18s, color .18s, border-color .18s, box-shadow .18s;
      outline: none;
      box-shadow: none;
      text-align: center;
      user-select: none;
    }
    .option-select-btn.selected, .option-select-btn:active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
      box-shadow: 0 2px 12px rgba(99,102,241,0.10);
    }
    .option-select-btn:hover {
      background: #e0e7ff;
      color: var(--primary);
      border-color: var(--primary);
    }
    html.dark .option-select-btn {
      background: #23232a;
      color: var(--primary);
      border-color: var(--border);
    }
    html.dark .option-select-btn.selected, html.dark .option-select-btn:active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
    }
    html.dark .option-select-btn:hover {
      background: #3730a3;
      color: #fff;
    }
    .btn-result {
      margin-top: 24px;
      padding: 12px 28px;
      font-size: 1.1rem;
      font-weight: 700;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      color: #fff;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: background .2s, transform .2s;
      box-shadow: 0 2px 8px rgba(34,211,238,0.08);
      display: block;
      width: 100%;
      max-width: 260px;
      margin-left: auto;
      margin-right: auto;
    }
    .btn-result:hover {
      opacity: 0.93;
      transform: scale(1.04);
      background: linear-gradient(90deg, var(--secondary), var(--primary));
    }
    nav[style*="display: none"] {
      pointer-events: none;
      opacity: 0;
    }
    nav[style*="display: flex"] {
      pointer-events: auto;
      opacity: 1;
      transition: opacity .3s;
    }
    @media (max-width: 900px) {
      .container { padding: 18px 2vw; }
      .dashboard-images { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
    }
    @media (max-width: 600px) {
      header h1 { font-size: 1.5rem; }
      .container { padding: 8px 2vw; gap: 18px;}
      .card { padding: 18px 8px;}
      .dashboard-grid { grid-template-columns: 1fr; gap: 14px;}
      .dashboard-images img { height: 80px;}
      nav { gap: 8px; font-size: 0.95rem;}
      .dark-toggle { right: 12px; top: 12px;}
    }
  </style>
</head>
<body>
  <header>
    <h1>ZenTrack ‚Äì Stress Detection & Therapy</h1>
    <p style="font-size:1.15rem;font-weight:500;margin-top:8px;opacity:.85;">Empowering your mind for a stress-free life</p>
    <button class="dark-toggle" id="darkToggle" title="Toggle dark mode">
      <span id="darkIcon">üåô</span> <span id="darkLabel">Dark Mode</span>
    </button>
  </header>
  <nav id="mainNav" style="display:none;">
    <a href="#" id="navDashboard" class="active" title="Go to your dashboard">üè† Dashboard</a>
    <a href="#" id="navTherapy" title="Explore music and yoga therapy">üßò Therapy</a>
    <a href="#" id="navAbout" title="Learn about ZenTrack">‚ÑπÔ∏è About</a>
    <a href="#" id="navContact" title="Contact the ZenTrack team">‚úâÔ∏è Contact</a>
    <a href="#" onclick="logout()" title="Logout from ZenTrack">üö™ Logout</a>
  </nav>
  <div class="container">
    <!-- Login -->
    <section id="loginStage" class="card" style="display:block;">
      <h2 style="color:var(--primary);margin-bottom:0.5em;">Login & Register</h2>
      <input type="text" id="username" placeholder="Enter email">
      <input type="password" id="password" placeholder="Enter password">
      <button class="btn btn-primary" onclick="simulateLogin()">Login</button>
      <button class="btn btn-secondary" onclick="simulateRegister()">Register</button>
      <p id="authResult"></p>
      <div style="margin-top:2em;color:var(--muted);font-size:1.05rem;">
        <b>New to ZenTrack?</b> Register to unlock personalized stress management tools, therapy resources, and your own dashboard.
      </div>
    </section>
    <!-- Sequential Anxiety Assessment -->
    <section id="anxietyAssessment" class="card" style="display:none;">
      <h2 style="color:var(--primary);">Anxiety Self-Assessment</h2>
      <form id="anxietyForm" autocomplete="off">
        <div id="anxietyQuestionBox"></div>
        <div id="anxietyNavBtns" style="margin-top:1em;">
          <button class="btn btn-secondary" type="button" id="prevQ" style="display:none;">Previous</button>
        </div>
        <button type="button" id="showResultBtn" class="btn-result" style="display:none;">Show Result</button>
      </form>
    </section>
    <!-- Dashboard -->
    <section id="dashboardStage" class="card" style="display:none;">
      <h2 style="color:var(--primary);font-size:2rem;margin-bottom:0.5em;">Dashboard</h2>
      <div class="dashboard-info">
        <strong>Welcome to your ZenTrack dashboard!</strong> Here you can chat with our AI bot, listen to calming music, try yoga therapy, visualize your stress levels, and learn more about the project. 
        <br><br>
        <span style="color:var(--muted);">Tip: Use the dark mode toggle for a relaxing night experience.</span>
      </div>
      <div class="dashboard-grid">
        <div class="feature-card" onclick="showSection('stressChartSection')" style="grid-column: span 2;">
          <h3>üìä Real-time Stress Trend</h3>
          <canvas id="stressChartDashboard" style="height: 200px;"></canvas>
          <p style="margin-top: 8px; color: var(--muted); font-size: 0.9rem;">Track your stress levels throughout the week.</p>
        </div>
        <div class="feature-card">
          <h3>üß† Current Stress Score</h3>
          <p style="font-size: 2.5rem; font-weight: 700; margin: 12px 0; color: var(--primary);" id="currentStressScore">40%</p>
          <p>Based on your latest anxiety assessment.</p>
        </div>
        <div class="feature-card" onclick="showSection('therapyStage')">
          <h3>üßò Therapy Sessions</h3>
          <p>Explore music and yoga therapy to relax.</p>
          <button class="btn btn-primary">Go to Therapy</button>
        </div>
        <div class="feature-card" onclick="showSection('chatFeature')">
          <h3>üí¨ Chat with Bot</h3>
          <p>Get instant support and advice for stress management.</p>
          <button class="btn btn-primary">Go to Chat</button>
        </div>
        <div class="feature-card">
          <h3>üìù Recent Activity</h3>
          <ul id="recentActivityList" style="list-style:none; padding-left:0; font-size:0.95rem; color: var(--muted); max-height: 140px; overflow-y: auto;">
            <li>Completed anxiety assessment</li>
            <li>Listened to music therapy</li>
            <li>Chatted with AI bot</li>
            <li>Practiced yoga session</li>
          </ul>
        </div>
      </div>
    </section>
    <!-- Therapy -->
    <section id="therapyStage" class="card" style="display:none;">
      <h2 style="color:var(--primary);font-size:2rem;margin-bottom:0.5em;">Therapy</h2>
      <div class="dashboard-grid">
        <div class="feature-card">
          <h3>üé∂ Music Therapy</h3>
          <p>Listen to relaxing music to calm your mind.</p>
          <iframe src="https://www.youtube.com/embed/5qap5aO4i9A" allowfullscreen></iframe>
        </div>
        <div class="feature-card">
          <h3>üßò Yoga Therapy</h3>
          <p>Follow guided yoga sessions for stress relief.</p>
          <iframe src="https://www.youtube.com/embed/v7AYKMP6rOE" allowfullscreen></iframe>
        </div>
      </div>
    </section>
    <!-- About -->
    <section id="aboutStage" class="card" style="display:none;">
      <h2 style="color:var(--primary);">About ZenTrack</h2>
      <p>
        <strong>ZenTrack</strong> is a modern mental health platform dedicated to helping individuals manage stress and improve well-being.
        Our mission is to provide accessible, science-backed tools and resources for stress detection, therapy, and personal growth.
      </p>
      <h3 style="color:var(--secondary);">About the Project</h3>
      <ul style="margin-bottom:1em;">
        <li>Personalized dashboard for stress tracking</li>
        <li>AI-powered chatbot for instant support</li>
        <li>Music and yoga therapy resources</li>
        <li>Visual stress graph for daily progress</li>
        <li>Responsive design with dark mode</li>
      </ul>
      <div style="margin-bottom:1em;color:var(--muted);font-size:1.05rem;">
        <b>Why ZenTrack?</b> We believe mental wellness should be accessible, interactive, and enjoyable. Our platform is designed for everyone‚Äîstudents, professionals, and anyone seeking a calmer mind.
      </div>
    </section>
    <!-- Contact -->
    <section id="contactStage" class="card" style="display:none;">
      <h2 style="color:var(--primary);">Contact Us</h2>
      <form id="contactForm">
        <input type="text" name="name" placeholder="Your Name" required>
        <input type="email" name="email" placeholder="Your Email" required>
        <textarea name="message" rows="4" placeholder="Your Message" required></textarea>
        <button class="btn btn-primary" type="submit">Send Message</button>
        <p id="contactResult" style="margin-top:10px;"></p>
      </form>
      <div style="margin-top:2em;color:var(--muted);font-size:1.05rem;">
        <b>Email:</b> <a href="mailto:yourmain123@gmail.com" style="color:var(--accent);text-decoration:underline;">yourmain123@gmail.com</a>
      </div>
      <div class="socials" style="margin-top:1em;">
        <a href="https://youtube.com" target="_blank" title="YouTube">üì∫</a>
        <a href="https://instagram.com" target="_blank" title="Instagram">üì∏</a>
        <a href="https://linkedin.com" target="_blank" title="LinkedIn">üíº</a>
        <a href="https://twitter.com" target="_blank" title="Twitter">üê¶</a>
      </div>
    </section>
    <!-- Chat Bot -->
    <section id="chatFeature" class="card" style="display:none;">
      <h3 style="color:var(--secondary);">üí¨ Chat with Bot</h3>
      <div id="chatBox"></div>
      <input type="text" id="chatInput" placeholder="Type your message...">
      <button class="btn btn-secondary" onclick="sendMessageGemini()">Send</button>
      <div style="margin-top:1em;color:var(--muted);font-size:0.98rem;">
        <b>How it works:</b> Ask anything about stress, relaxation, or mental health. The AI bot will reply instantly!
      </div>
    </section>
    <!-- Stress Chart -->
    <section id="stressChartSection" class="card" style="display:none;">
      <h3 style="color:var(--secondary);">üìä Stress Graph Dashboard</h3>
      <canvas id="stressChart"></canvas>
      <div id="stressResult" style="margin-top:1em;color:var(--muted);font-size:1.08rem;font-weight:600;"></div>
      <div style="margin-top:1em;color:var(--muted);font-size:0.98rem;">
        <b>Tip:</b> Track your stress levels daily to see your progress.
      </div>
    </section>
  </div>
  <footer id="footer">
    <p style="font-size:1.1rem;">Need support? Contact us at <a href="mailto:yourmain123@gmail.com" style="color:var(--accent);text-decoration:underline;">yourmain123@gmail.com</a></p>
    <p style="margin-top:18px;">¬© 2025 ZenTrack ‚Äì All Rights Reserved</p>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Navigation logic
    function showSection(id) {
      document.querySelectorAll('.card').forEach(s => s.style.display = 'none');
      document.getElementById(id).style.display = 'block';
      document.querySelectorAll('#mainNav a').forEach(a => a.classList.remove('active'));
      if (id === 'dashboardStage') document.getElementById('navDashboard').classList.add('active');
      if (id === 'therapyStage') document.getElementById('navTherapy').classList.add('active');
      if (id === 'aboutStage') document.getElementById('navAbout').classList.add('active');
      if (id === 'contactStage') document.getElementById('navContact').classList.add('active');
    }

    // Initialize Chart.js for dashboard stress trend
    const ctxDashboard = document.getElementById('stressChartDashboard').getContext('2d');
    window.stressChartDashboard = new Chart(ctxDashboard, {
      type: 'line',
      data: {
        labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
        datasets: [{
          label: 'Stress Level',
          data: [20,45,35,60,30,50,40],
          borderColor: '#6366f1',
          backgroundColor: 'rgba(99,102,241,0.12)',
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { labels: { color: '#6366f1' } } },
        scales: { 
          x: { ticks: { color: '#6366f1' } }, 
          y: { ticks: { color: '#6366f1' }, beginAtZero: true, max: 100 } 
        }
      }
    });

    // Only allow navigation if not in assessment
    function navHandler(sectionId) {
      return function(e) {
        if (window.inAssessment) {
          alert("Please complete the assessment before navigating.");
          e.preventDefault();
          return false;
        }
        showSection(sectionId);
      }
    }
    document.getElementById('navDashboard').onclick = navHandler('dashboardStage');
    document.getElementById('navTherapy').onclick = navHandler('therapyStage');
    document.getElementById('navAbout').onclick = navHandler('aboutStage');
    document.getElementById('navContact').onclick = navHandler('contactStage');

    // Sequential Anxiety Assessment Logic with direct select options
    const anxietyQuestions = [
      "Do you often feel worried or afraid something bad will happen?",
      "Do you feel nervous, tense, or find it hard to relax?",
      "Do you have fears, like being alone, in the dark, in traffic, or around strangers or crowds?",
      "Do you have trouble sleeping (falling asleep, staying asleep, or bad dreams)?",
      "Do you find it hard to focus or remember things?",
      "Do you often feel sad, lose interest in things you enjoy, or feel hopeless?",
      "Do you get body pains, tight muscles, twitching, or grind your teeth?",
      "Do you get strange feelings like blurred vision, ringing in your ears, hot/cold flashes, weakness, or tingling?",
      "Do you notice your heart beating fast, pounding, skipping beats, or feel chest pain?",
      "Do you have trouble breathing, feel short of breath, or feel like choking?",
      "Do you have stomach problems (like nausea, stomach pain, constipation, diarrhea, or loss of appetite)?",
      "Do you notice changes in bathroom habits or sex life (like frequent urination, low interest in sex, or changes with periods)?",
      "Do you get physical stress symptoms like dry mouth, sweating, dizziness, headache, or feeling hot/cold suddenly?",
      "Do you fidget, shake, pace, sigh a lot, or look tense when you are anxious?",
      "Overall, how strong has your anxiety been this past week?"
    ];
    let anxietyAnswers = Array(anxietyQuestions.length).fill(null);
    let currentQ = 0;
    let inAssessment = false;
    let latestAnxietyResult = "";

    function renderAnxietyQuestion() {
      inAssessment = true;
      const box = document.getElementById('anxietyQuestionBox');
      box.innerHTML = `
        <div style="margin-bottom:1em;">
          <label style="font-weight:500;">Q${currentQ+1}. ${anxietyQuestions[currentQ]}</label>
          <div class="option-select-row">
            ${[0,1,2,3,4].map(val => `
              <div class="option-select-btn${anxietyAnswers[currentQ]===val?' selected':''}" 
                data-value="${val}" tabindex="0">
                ${val === 0 ? "Never" : val === 1 ? "Rarely" : val === 2 ? "Sometimes" : val === 3 ? "Often" : "Always"}
                <div style="font-size:0.95em;color:var(--muted);margin-top:2px;">[${val}]</div>
              </div>
            `).join('')}
          </div>
        </div>
        <div style="color:var(--muted);font-size:0.98rem;">Question ${currentQ+1} of ${anxietyQuestions.length}</div>
      `;
      document.getElementById('prevQ').style.display = currentQ > 0 ? '' : 'none';
      document.getElementById('showResultBtn').style.display = "none";

      // Add click event for direct select
      document.querySelectorAll('.option-select-btn').forEach(btn => {
        btn.onclick = function() {
          document.querySelectorAll('.option-select-btn').forEach(b => b.classList.remove('selected'));
          this.classList.add('selected');
          anxietyAnswers[currentQ] = parseInt(this.getAttribute('data-value'), 10);

          // Auto move to next question or show result button
          if (currentQ < anxietyQuestions.length - 1) {
            currentQ++;
            setTimeout(renderAnxietyQuestion, 150);
          } else {
            // Show result button at the end
            document.getElementById('showResultBtn').style.display = "block";
          }
        };
        btn.onkeydown = function(e) {
          if(e.key === "Enter" || e.key === " ") {
            this.click();
          }
        }
      });
    }

    document.getElementById('prevQ').onclick = function() {
      if(currentQ > 0) currentQ--;
      renderAnxietyQuestion();
    };

    // Show result button logic
    document.getElementById('showResultBtn').onclick = function() {
      let total = anxietyAnswers.reduce((a,b)=>a+(b||0),0);
      let result = "";
      if (total <= 10) result = "Minimal anxiety. Keep up your healthy habits!";
      else if (total <= 20) result = "Mild anxiety. Try relaxation and self-care.";
      else if (total <= 35) result = "Moderate anxiety. Consider talking to someone or using therapy tools.";
      else result = "Severe anxiety. Please consider reaching out to a mental health professional.";
      document.getElementById('anxietyForm').style.display = 'none';
      latestAnxietyResult = `Your score: ${total} ‚Äì ${result}`;
      let lastAnxietyScore = Math.round((total / (anxietyQuestions.length * 4)) * 100);
      window.stressChart.data.datasets[0].data[6] = lastAnxietyScore;
      window.stressChart.update();

      inAssessment = false;

      setTimeout(() => {
        // Show result in stress chart section and nav
        document.getElementById('mainNav').style.display = 'flex';
        showSection('stressChartSection');
        document.getElementById('stressResult').innerText = latestAnxietyResult;
        // Reset assessment for next time
        document.getElementById('anxietyForm').style.display = '';
        document.getElementById('showResultBtn').style.display = "none";
        anxietyAnswers = Array(anxietyQuestions.length).fill(null);
        currentQ = 0;
        renderAnxietyQuestion();
      }, 700);
    };

    // On login, redirect to sequential assessment and hide nav/login
    function simulateLogin(){
      const email = document.getElementById('username').value;
      const pass = document.getElementById('password').value;
      if(email && pass){
        document.getElementById('authResult').innerText = `Welcome ${email}`;
        document.getElementById('mainNav').style.display = 'none';
        document.getElementById('loginStage').style.display = 'none';
        // Reset assessment state
        anxietyAnswers = Array(anxietyQuestions.length).fill(null);
        currentQ = 0;
        renderAnxietyQuestion();
        document.getElementById('anxietyForm').style.display = '';
        document.getElementById('showResultBtn').style.display = "none";
        showSection('anxietyAssessment');
      } else {
        document.getElementById('authResult').innerText = 'Please enter email and password';
      }
    }

    function simulateRegister(){
      const email = document.getElementById('username').value;
      document.getElementById('authResult').innerText = email ? `Registered new user: ${email}` : 'Enter email to register';
    }

    function logout(){
      showSection('loginStage');
      document.getElementById('mainNav').style.display = 'none';
      document.getElementById('loginStage').style.display = 'block';
      document.querySelectorAll('#mainNav a').forEach(a => a.classList.remove('active'));
    }

    // Chart.js initialization for stress graph
    const ctx = document.getElementById('stressChart').getContext('2d');
    window.stressChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
        datasets: [{
          label: 'Stress Level',
          data: [20,45,35,60,30,50,40],
          borderColor: '#6366f1',
          backgroundColor: 'rgba(99,102,241,0.12)',
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { labels: { color: '#6366f1' } } },
        scales: { 
          x: { ticks: { color: '#6366f1' } }, 
          y: { ticks: { color: '#6366f1' }, beginAtZero: true, max: 100 } 
        }
      }
    });

    // Chat Bot
 async function sendMessageGemini() {
      const chatInput = document.getElementById('chatInput');
      const message = chatInput.value.trim();
      if (!message) return;
      addMessage(message, 'user');
      chatInput.value = '';

      // Loader
      const loaderId = 'loader-' + Date.now();
      addMessage("‚è≥ Bot is typing...", 'bot', false, loaderId);

      try {
        const response = await fetch(
          'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=AIzaSyBfEIE-_CATLuOSVx_wAwDFR0AszOvvgUI',
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              contents: [{ parts: [{ text: message }] }]
            })
          }
        );
        const data = await response.json();

        console.log("Gemini API response:", data);
        // Replace loader with reply
        let botReply = data?.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't understand.";
        botReply = botReply.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
                           .replace(/\*(.*?)\*/g, '<i>$1</i>')
                           .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');

        updateMessage(loaderId, botReply, true);
      } catch (error) {
        console.error(error);
        updateMessage(loaderId, "‚ö†Ô∏è Error connecting to bot.", false);
      }
    }

    function addMessage(text, sender, isHTML=false, id=null){
      const chatBox = document.getElementById('chatBox');
      const msg = document.createElement('div');
      msg.classList.add('message', sender);
      if(id) msg.id = id;
      if(isHTML) {
        msg.innerHTML = text;
      } else {
        msg.innerText = text;
      }
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function updateMessage(id, text, isHTML=false){
      const msg = document.getElementById(id);
      if(msg){
        if(isHTML) msg.innerHTML = text;
        else msg.innerText = text;
      }
    }

    // ‚úÖ Enter key support
    document.getElementById('chatInput').addEventListener("keydown", function(e) {
      if (e.key === "Enter") {
        e.preventDefault();
        sendMessageGemini();
      }
    });



    // Contact form logic (send to email)
    document.getElementById('contactForm').onsubmit = function(e) {
      e.preventDefault();
      // Compose mailto link
      const name = this.name.value;
      const email = this.email.value;
      const message = this.message.value;
      const subject = encodeURIComponent("ZenTrack Contact Form Submission");
      const body = encodeURIComponent(`Name: ${name}\nEmail: ${email}\nMessage: ${message}`);
      window.location.href = `mailto:kajal2005agarwal@gmail.com?subject=${subject}&body=${body}`;
      document.getElementById('contactResult').innerText = "Thank you for contacting us! Your email client should open now.";
      this.reset();
    };

    // Dark mode toggle
    const darkToggle = document.getElementById('darkToggle');
    const darkIcon = document.getElementById('darkIcon');
    const darkLabel = document.getElementById('darkLabel');
    function setDarkMode(on) {
      if(on) {
        document.documentElement.classList.add('dark');
        document.body.classList.add('dark');
        darkIcon.textContent = "‚òÄÔ∏è";
        darkLabel.textContent = "Light Mode";
        localStorage.setItem('zentrack-dark', '1');
      } else {
        document.documentElement.classList.remove('dark');
        document.body.classList.remove('dark');
        darkIcon.textContent = "üåô";
        darkLabel.textContent = "Dark Mode";
        localStorage.setItem('zentrack-dark', '0');
      }
    }
    darkToggle.onclick = function() {
      setDarkMode(!document.documentElement.classList.contains('dark'));
    };
    if(localStorage.getItem('zentrack-dark') === '1') setDarkMode(true);

    // Show login on load
    showSection('loginStage');
  </script>
</body>
</html>
